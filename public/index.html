<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Program Notes</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/7.6.1/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/7.6.1/firebase-auth.js"></script>
    <script defer src="/__/firebase/7.6.1/firebase-database.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>

    <style media="screen">
      body { background: black; color: white; font-family: -apple-system, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      a {color: white; text-decoration: underline;}
      #message { background: #121212; max-width: 360px; margin: 100px auto 16px; padding: 32px 24px; border-radius: 3px; }
      #message h2 { color: #BB86FC; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a.cta { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
      #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #controlButtons { display: none; }
      #currentProgram > div {display: none;} 
      label {display: block;  padding: 8px 0;} 
      button { height: 44px; min-width: 44px; margin: 36px 8px 0; padding: 8px; background-color: #BB86FC}
      @media (max-width: 600px) {
        body, #message { margin-top: 0; background: #121212; box-shadow: none; }
        body { border-top: 16px solid #BB86FC; }
      }
      @-ms-viewport{ width: device-width; }

      input[type=checkbox] {
        width: 1em;
        height: 1em;
        background-color: white;
        border-radius: 33%;
        vertical-align: middle;
        border: 1px 4px solid #ddd;
        -webkit-appearance: none;
        outline: none;
        cursor: pointer;
        margin: 2px 4px;
      }
      input[type=checkbox]:checked {
        background-color: #3700B3;
      }

      #message ul {list-style-type: none; padding: 0;}
      #message ul li {padding: 4px; border-radius: 4px}
      #message ul li p {margin: 4px 0;}
      .highlighted {background-color: #BB86FC; color: #121212; margin: 4px 0;}
      .section {margin-top: 8px;}

      #message .note > p {border-bottom: 1px solid gray; padding-bottom: 16px; margin: 16px 0;}
      #message #note0 > p {border: 0; padding-bottom: 8px; margin: 8px;}
    </style>
  </head>
  <body>
    <div id="message">
      <!--h2>Zach Weiner, piano</h2-->
      <div id="currentProgram">
        <div id="controlButtons">
          <button id="prevButton">Previous</button>
          <button id="nextButton">Next</button>
          <button id="resetButton">Reset</button>
        </div>

        <h3 id="movementNum"></h3>
        
        <div id="note0" class="note">
          <p>Please make sure that your phone is in do not disturb mode. These program notes are meant to give people new to this piece a "way in" to Schubert's world.</p>
          <p>Some <a target=_blank href="http://www.stephenhough.com/writings/album-notes/schubert-sonatas.php">excerpts</a> I like from Stephen Hough's program notes: </p>

<p>SCHUBERT, in his late piano sonatas, is revealed more as a listener than a speaker...
</p>
<p>
 Here there is neither the superficial gloss of refinement nor the mawkish self-consciousness of profundity; rather Schubert's miraculous ability to bare his soul without a trace of narcissism - a combined result of his humility, universality, and an exquisite unawareness of either.
</p>
<p>
"Art is waiting: inspiration is waiting. Humility is a certain relation of the soul to time. It is an acceptance of waiting." – Simone Weil
</p>
        </div>

        <div id="note1" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="highlighted">
            Exposition: Theme 1 "Trill"
            <p>
              A pure, lyrical melody, marked by a low rumbling trill at the end, and silence. These three elements - beauty, darkness, and silence - and their interplay are the foundation for the entire sonata's philosophy.
            </p>
            </li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Repeat: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Development</li>
            <li class="section">Recapitulation</li>
            <li class="">Coda</li>
          </ul>
        </div>

        <div id="note2" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="">Exposition: Theme 1 "Trill"</li>
            <li class="highlighted">Theme 1.5 "Chamber"
            <p>
              Follow the mood shifts, sometimes subtle, sometimes abrupt. Now in the distant key of F# minor, a cello in a string quartet begins a melody. Is this the song of Schubert baring his soul, or is there some of all of us in it?
            </p>
            </li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Repeat: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Development</li>
            <li class="section">Recapitulation</li>
            <li class="">Coda</li>
          </ul>
        </div>

        <div id="note3" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="">Exposition: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="highlighted">Theme 2 "Dance"
              <p>
                A lighter motive that dances, then disintegrates as it runs out of steam. These themes, once familiar, will become transformed later on.
              </p>
            </li>
            <li class="section">Repeat: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Development</li>
            <li class="section">Recapitulation</li>
            <li class="">Coda</li>
          </ul>
        </div>

        <div id="note4" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="">Exposition: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section highlighted">Repeat: Theme 1 "Trill"
              <p>
                This theme begins as a distant idea. Listen to it spin and weave until it's finally spoken out loud. This sonata was Schubert's last, and many consider it his farewell.
              </p>
              <p>
                The calm breaks off into a dark, rumbling trill in the bass. What does this evoke for you?
              </p>
              <label><input type="checkbox" name="checkbox">A distant storm over the ocean</label>
              <label><input type="checkbox" name="checkbox">A secret waiting to be told</label>
              <label><input type="checkbox" name="checkbox">The spectre of death approaching</label>
              <label><input type="checkbox" name="checkbox">A suppressed reminder of reality</label>
            </li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Development</li>
            <li class="section">Recapitulation</li>
            <li class="">Coda</li>
          </ul>
        </div>

        <div id="note5" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="">Exposition: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Repeat: Theme 1 "Trill"</li>
            <li class="highlighted">Theme 1.5 "Chamber"
              <p>
                This is not so much a theme proper, but more of a transitory wandering in search of something more stable, unsettled between major and minor tonalities. Follow as it rises and falls over and over. What could this music be contemplating?
              </p>
              <label><input type="checkbox" name="checkbox">Waters growing murkier</label>
              <label><input type="checkbox" name="checkbox">A journey looking back in time</label>
              <label><input type="checkbox" name="checkbox">Grappling with meaning and mortality</label>
            </li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Development</li>
            <li class="section">Recapitulation</li>
            <li class="">Coda</li>
          </ul>
        </div>

        <div id="note6" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="">Exposition: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Repeat: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="highlighted">Theme 2 "Dance"
              <p>
                Finally, we come to a joyful arrival. Follow it as it transforms and unravels. What could this represent?
              </p>
              <label><input type="checkbox" name="checkbox">The Platonic form of joy</label>
              <label><input type="checkbox" name="checkbox">An imagined utopia from another time</label>
              <label><input type="checkbox" name="checkbox">The dance of two people in love</label>
              <label><input type="checkbox" name="checkbox">A façade of happiness</label>
            </li>
            <li class="section">Development</li>
            <li class="section">Recapitulation</li>
            <li class="">Coda</li>
          </ul>
        </div>

        <div id="note7" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="">Exposition: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Repeat: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section highlighted">Development
              <p>
                Our opening theme returns in the foreign key of c-sharp minor. Then, the dance enters, but the bass line takes over and Schubert tells us a story:
              </p>
              <label><input type="checkbox" name="checkbox">The storm draws near</label>
              <label><input type="checkbox" name="checkbox">A spiritual struggle with a higher power</label>
              <label><input type="checkbox" name="checkbox">The drama of a human relationship</label>
              <label><input type="checkbox" name="checkbox">An origin story from long ago</label>
            </li>
            <li class="section">Recapitulation</li>
            <li class="">Coda</li>
          </ul>
        </div>

        <div id="note8" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="">Exposition: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Repeat: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Development</li>
            <li class="section highlighted">Recapitulation
              <p>
                We finally return home to the original themes, but home never feels quite as we remembered it when returning from a journey. </p>
              <p>Hough writes, "The pen has to be set down on the desk, the body rested against the back of a chair, and a listener's whole being surrendered to another sphere."
              </p>
              <p>Rather than setting the music to words, focus on the sound itself and the feelings it engenders, which transcend language.</p>
            </li>
            <li class="">Coda</li>
          </ul>
        </div>

        <div id="note9" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> I. Molto moderato</h4>
          <ul>
            <li class="">Exposition: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Repeat: Theme 1 "Trill"</li>
            <li class="">Theme 1.5 "Chamber"</li>
            <li class="">Theme 2 "Dance"</li>
            <li class="section">Development</li>
            <li class="section">Recapitulation</li>
            <li class="highlighted">Coda
              <p>The movement sputters to a close with only fragments of its beautiful theme separated with silence, struggling to hold together.</p>
            </li>
          </ul>
        </div>

        <div id="note10" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> II. Andante sostenuto</h4>
          <ul>
            <li class="highlighted">A section (C-sharp minor)
              <p>
                Brendel said, Schubert "lets himself be transported, just a hair’s breadth from the abyss, not so much mastering life as being at its mercy."
              </p>
              <p>
                The right-hand melody is by turns lamenting and reaching. Meanwhile, the left-hand accompaniment plays a hypnotic rising pattern, providing forward direction "like rowing a boat," as Fleisher wrote. 
              </p>
            </li>
            <li class="">B section (A Major)</li>
            <li class="">A section (C-sharp minor)</li>
          </ul>
        </div>

        <div id="note11" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> II. Andante sostenuto</h4>
          <ul>
            <li class="">A section (C-sharp minor)</li>
            <li class="highlighted">B section (A Major)
              <p>The music opens up to a chorale in A Major with a persistent bass accompaniment. How do you see this music?</p>
              <label><input type="checkbox" name="checkbox">Attempted consolation</label>
              <label><input type="checkbox" name="checkbox">Peace and redemption amid tragedy</label>
              <label><input type="checkbox" name="checkbox">The skies clear</label>
              <label><input type="checkbox" name="checkbox">A choir of angels overhead</label>
            </li>            
            <li class="">A section (C-sharp minor)</li>
          </ul>
        </div>

        <div id="note12" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> II. Andante sostenuto</h4>
          <ul>
            <li class="">A section (C-sharp minor)</li>
            <li class="">B section (A Major)</li>
            <li class="highlighted">A section (C-sharp minor)
              <p>
                Silence gives way to the return of the original melody with a more insistent accompaniment, whose darkness is reminiscent of the opening trill.
              </p><p>
                Words cannot do justice to the heart-stopping harmonic changes in this movement's closing, and the experience upon reaching the reluctant acceptance of its conclusion.
              </p>
            </li>
          </ul>
        </div>

        <div id="note13" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> III. Scherzo. Allegro vivace con delicatezza</h4>
          <ul>
            <li class="highlighted">Opening
              <p>
                "Scherzo" literally means "joke", but composers often apply it to music both light and dark. How would you describe this music?
              </p>
              <label><input type="checkbox" name="checkbox">Life goes on</label>
              <label><input type="checkbox" name="checkbox">A wistful memory of youth</label>
              <label><input type="checkbox" name="checkbox">The countryside after the rain</label>
              <label><input type="checkbox" name="checkbox">The playground of the gods</label>
            </li>
            <li class="">Trio</li>
            <li class="">Reprise</li>
          </ul>
        </div>

        <div id="note14" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> III. Scherzo. Allegro vivace con delicatezza</h4>
          <ul>
            <li class="">Opening</li>
            <li class="highlighted">Trio
              <p>
                In the middle section, Schubert is still dancing, but he peels back the surface to give a glimpse of another layer underneath.
              </p>
            </li>
            <li class="">Reprise</li>
          </ul>
        </div>

        <div id="note15" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> III. Scherzo. Allegro vivace con delicatezza</h4>
          <ul>
            <li class="">Opening</li>
            <li class="">Trio</li>
            <li class="highlighted">Reprise
              <p>Schubert packs so much nuance in this short scene. Can you hear some of these?</p>
              <label><input type="checkbox" name="checkbox">Witty and playful surprises</label>
              <label><input type="checkbox" name="checkbox">Making a mistake and trying again</label>
              <label><input type="checkbox" name="checkbox">Calls and responses from two characters</label>
            </li>
          </ul>
        </div>

        <div id="note16" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> IV. Allegro ma non troppo</h4>
          <ul>
            <li class="highlighted">Bell
              <p>
                The final movement, cast in sonata-rondo form, opens with a ringing open octave G. For whom does this bell toll? Artur Schnabel put words to the melody that follows: “Ich weiss nicht, ob ich lache, ich weiss nicht, ob ich weine.” I know not if I'm laughing, I know not if I'm crying.
              </p>
            </li>
            <li class="">Dance</li>
            <li class="">Skipping</li>
            <li class="">Development</li>
            <li class="">Recapitulation</li>
          </ul>
        </div>

        <div id="note17" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> IV. Allegro ma non troppo</h4>
          <ul>
            <li class="">Bell</li>
            <li class="highlighted">Dance
              <p>
                In this syncopated dance, a relaxed, major-key melody arises, but it lapses from time to time into ambiguous emotional territory. Do you see this expression as
              </p>
              <label><input type="checkbox" name="checkbox">The dance of a young couple</label>
              <label><input type="checkbox" name="checkbox">A nostalgic smile</label>
              <label><input type="checkbox" name="checkbox">The lightness of contentment</label>
              <label><input type="checkbox" name="checkbox">Floating above worldly concerns</label>
            </li>
            <li class="">Skipping</li>
            <li class="">Development</li>
            <li class="">Recapitulation</li>
          </ul>
        </div>

        <div id="note18" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> IV. Allegro ma non troppo</h4>
          <ul>
            <li class="">Bell</li>
            <li class="">Dance</li>
            <li class="highlighted">Skipping <!-- Trigger this early -->
              <p>
                Interruption, silence, and a storm, which eventually skips back to the first theme. This story is
              </p>
              <label><input type="checkbox" name="checkbox">Internal</label>
              <label><input type="checkbox" name="checkbox">Interpersonal</label>
              <label><input type="checkbox" name="checkbox">Natural</label>
              <label><input type="checkbox" name="checkbox">Cosmic</label>
              <p>
                Or are these all just the same story?
              </p>
            </li>
            <li class="">Development</li>
            <li class="">Recapitulation</li>
          </ul>
        </div>

        <div id="note19" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> IV. Allegro ma non troppo</h4>
          <ul>
            <li class="">Bell</li>
            <li class="">Dance</li>
            <li class="">Skipping</li>
            <li class="highlighted">Development
              <p>
                The bell tolls to signal the return of the main theme. It is heard abridged before it goes for a ride, seemingly in conflict with itself.
              </p>
            </li>
            <li class="">Recapitulation</li>
          </ul>
        </div>

        <div id="note20" class="note">
          <h3>Schubert Sonata in B-Flat Major</h3>
          <h4> IV. Allegro ma non troppo</h4>
          <ul>
            <li class="">Bell</li>
            <li class="">Dance</li>
            <li class="">Skipping</li>
            <li class="">Development</li>
            <li class="highlighted">Recapitulation
              <p>
                As the bell rings and the themes are heard again, we ask if these are all different stories or just different sides of a larger one.
              </p>
              <p>
                Pianist Jörg Demus said, "[Schubert's piano melodies] wander along with gentle corpulence – likenesses of their creator – through the musical keys as through countrysides, changing by means of an apparently abrupt harmonic inflection, appearing suddenly in another light and assuming a new countenance from one measure to another.” 
              </p>
              <p>
                At the close, the bell returns, slowly falling with uncertainty - and then, again, silence - before Schubert shakes it off to conclude the work.
              </p>
            </li>
          </ul>
        </div>

        <div id="note21">
          <h3>Thank you.</h3>
          If you enjoyed this, read more and keep in touch at <a class="cta" href="https://doublebarline.com/#subscribe">doublebarline.com</a>
        </div>
      </div>
    </div>

    <script>


      let startingState = 0;
      class ProgramNotes {
        constructor() {
          // TODO: This is hacky, as it saves this to the database forever.
          let url = new URL(window.location.href);
          let selfControlled = url.searchParams.get("selfControlled");
          let programID = selfControlled ? "program" + Math.floor(Date.now()) : "TestProgramID";

          this.programID = programID;
          this.currentState = startingState;
          let db = firebase.database();
          this.programRef = db.ref("/programs/" + this.programID)
        }
        start() {
          this.programRef.on('value', function(snapshot) {
            let oldState = this.currentState;
            if (snapshot.exists()) {
              this.currentState = snapshot.val();
            }

            // document.getElementById("movementNum").textContent = this.currentState;
            document.getElementById("note" + oldState).style.display = "none";
            document.getElementById("note" + this.currentState).style.display = "block";
            // document.getElementById("note" + this.currentState).scrollIntoView();
          }.bind(this));
        }

        // TODO: Auth for these write functions...
        increment() {
          let index = this.currentState + 1;
          this.programRef.set(index);
          this.tellDemo(index);
        }
        decrement() {
          let index = this.currentState - 1;
          this.programRef.set(index);
          this.tellDemo(index);
        }
        reset() {
          this.programRef.set(0); 
          this.tellDemo(0);
        }

        tellDemo(index) {
          if (window.parent) {
            // TODO: security
            window.parent.postMessage(index, "*");
          }
        }
      }

      var notes;
      function setIndex(index) {
        if (index >= 0 && !!notes && index != notes.currentState) {
          notes.programRef.set(index);
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
        // // The Firebase SDK is initialized and available here!
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
        notes  = new ProgramNotes();

        notes.start();
        document.getElementById('nextButton').onclick = function() {
          notes.increment();
        };
        document.getElementById('prevButton').onclick = function() {
          notes.decrement();
        };
        document.getElementById('resetButton').onclick = function() {
          notes.reset();
        };


        let url = new URL(window.location.href);
        let present = url.searchParams.get("present");
        if (present) {
          document.getElementById('controlButtons').style.display = 'block';
        }

        try {
          let app = firebase.app();
          let features = ['auth', 'database'].filter(feature => typeof app[feature] === 'function');
          console.log(`Firebase SDK loaded with ${features.join(', ')}`);
        } catch (e) {
          console.error(e);
          console.log('Error loading the Firebase SDK, check the console.');
        }
      });
    </script>
  </body>
</html>
