<iframe id="yt" width="560" height="100%" src="https://www.youtube.com/embed/8xDABzplnao?controls=1&enablejsapi=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<iframe src="/index.html?present=true" width="400" height="100%" id="notes"></iframe>
<div id="instructions">

</div>
<script>
// Get current time from player every second, then map from time to where we are.

var tag = document.createElement('script');
tag.id = 'iframe-demo';
tag.src = 'https://www.youtube.com/iframe_api';
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
let noteFrame = document.getElementById("notes");

let times = [
	0,
	25,
	2*60 + 45,
	4*60,
	5*60 + 40,
	8*60 + 24,
	9*60 + 33,
	11*60 + 20,
	15*60 + 40,
	20*60 + 57,
	22*60 + 25,
	999999999999 // Hack for off by one error.
];

var player;
function onYouTubeIframeAPIReady() {
	player = new YT.Player('yt', {
	    events: {
	      'onReady': onPlayerReady,
	    }
	});
}

function onPlayerReady(event) {
	console.log('ready')
	setInterval(sync, 500);

}

function sync() {
	let secs = player.getCurrentTime();
	var index = 0;
	for (i = 1; i < times.length; i++) {
		if (secs  >= times[i - 1] && secs < times[i]) {
			index = i - 1;
			break;
		}
	}
	noteFrame.contentWindow.setIndex(index);
}

window.addEventListener("message", function(e) {
	if (e.source !== noteFrame.contentWindow) return;

	let time = times[e.data];
	if (player) {
		player.seekTo(time, true /* allowSeekAhead */);
	}
});

</script>

<style>
	body { margin: 0 8px; }
	#instructions {display: inline-block;}
</style>